version: "3.9"

services:
  api-gateway:
    build: .
    container_name: api_gateway
    restart: unless-stopped
    
    # Enables host.docker.internal on Linux
    extra_hosts:
      - "host.docker.internal:host-gateway"

    environment:
      # Backend Internal API (Data Module)
      # Accessing via host port because DM and Gateway are in separate compose projects
      DATA_MODULE_URL: "http://host.docker.internal:8080"

      # Streams (Nginx-RTMP / HLS)
      STREAM_BASE_URL: "http://host.docker.internal:8080"

      # Kafka (decisions realtime)
      KAFKA_BOOTSTRAP_SERVERS: "host.docker.internal:9092"
      KAFKA_DECISION_TOPIC: "decision_results"
      KAFKA_CONSUMER_GROUP: "api-gateway-decisions"

      ENV: "production"

    ports:
      - "8000:8000"
